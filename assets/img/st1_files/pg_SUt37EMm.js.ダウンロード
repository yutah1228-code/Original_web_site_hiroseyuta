;/*FB_PKG_DELIM*/

__d("IGDGetThread",[],(function(a,b,c,d,e,f){"use strict";function g(a){return"SlideThread:"+a}function h(a){return"XFBIGDirectViewerThread:"+a}function a(a,b){return a.get(g(b))}function b(a,b){return a.get(h(b))}f.GetSlideThreadDataID=g;f.GetXFBIGDirectViewerThreadDataID=h;f.getSlideThreadNullable=a;f.getIGDirectViewerThreadNullable=b}),66);
__d("LSMarkBumpedThreadsSeen",["LSIssueNewFireAndForgetTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.islc(c.filter(c.db.table(9).fetchDesc([[[a[0]]],"secondaryParentThreadKeyLastActivityTimestampMs"]),function(b){return c.i64.eq(b.secondaryParentThreadKey,a[0])&&[c.i64.cast([0,18]),c.i64.cast([0,23]),c.i64.cast([0,21]),c.i64.cast([0,27])].some(function(a){return c.i64.eq(b.threadType,a)})}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var g=e.done;e=e.value;return g?0:(f=e.item,d[0]=f.lastActivityTimestampMs,c.i64.gt(d[0],c.i64.cast([0,0]))?c.db.table(35).fetch([[[a[0]]]]).next().then(function(f,h){var e=f.done;f=f.value;return e?c.sequence([function(b){return c.db.table(35).add({parentThreadKey:a[0],lastSeenRequestTimestampMs:d[0]})},function(e){return d[2]=new c.Map(),d[2].set("parent_thread_key",a[0]),d[2].set("last_seen_time_ms",d[0]),d[3]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewFireAndForgetTask"),"fire_forget",c.i64.cast([0,6]),d[3])}]):(h=f.item,c.i64.lt(h.lastSeenRequestTimestampMs,d[0])?c.sequence([function(b){return c.db.table(35).add({parentThreadKey:a[0],lastSeenRequestTimestampMs:d[0]})},function(e){return d[2]=new c.Map(),d[2].set("parent_thread_key",a[0]),d[2].set("last_seen_time_ms",d[0]),d[3]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewFireAndForgetTask"),"fire_forget",c.i64.cast([0,6]),d[3])}]):c.resolve())}):c.resolve())})},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxMarkBumpedThreadsSeenStoredProcedure";a.__tables__=["threads","folder_metadata"];e.exports=a}),null);
__d("LSMarkBumpedThreadsSeenStoredProcedure",["LSMarkBumpedThreadsSeen","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSMarkBumpedThreadsSeen"),e.secondaryParentThreadKey);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSMarkFolderSeen",["LSIssueNewFireAndForgetTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(b){return c.db.table(9).fetch([[[a[0]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[0]=void 0:(b=a.item,d[0]=b.threadType)})},function(e){return c.i64.eq(d[0],c.i64.cast([0,17]))?c.sequence([function(b){return d[2]=c.i64.of_float(Date.now()),c.forEach(c.db.table(9).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({lastReadWatermarkTimestampMs:d[2]})})},function(e){return d[3]=c.i64.of_float(Date.now()),c.i64.gt(d[3],c.i64.cast([0,0]))?c.db.table(35).fetch([[[a[0]]]]).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(b){return c.db.table(35).add({parentThreadKey:a[0],lastSeenRequestTimestampMs:d[3]})},function(e){return d[6]=new c.Map(),d[6].set("parent_thread_key",a[0]),d[6].set("last_seen_time_ms",d[3]),d[7]=c.toJSON(d[6]),c.storedProcedure(b("LSIssueNewFireAndForgetTask"),"fire_forget",c.i64.cast([0,6]),d[7])}]):(f=e.item,c.i64.lt(f.lastSeenRequestTimestampMs,d[3])?c.sequence([function(b){return c.forEach(c.db.table(35).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({lastSeenRequestTimestampMs:d[3]})})},function(e){return d[6]=new c.Map(),d[6].set("parent_thread_key",a[0]),d[6].set("last_seen_time_ms",d[3]),d[7]=c.toJSON(d[6]),c.storedProcedure(b("LSIssueNewFireAndForgetTask"),"fire_forget",c.i64.cast([0,6]),d[7])}]):c.resolve())}):c.resolve()},function(b){return d[4]=c.i64.of_float(Date.now()),c.forEach(c.db.table(162).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({readTimestampMs:d[4]})})}]):c.sequence([function(b){return c.islc(c.sortBy(c.filter(c.db.table(276).fetch(),function(b){return c.i64.eq(b.folderType,a[0])}),[["lastActivityAuthoritativeTsMs","DESC"]]),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?d[2]=c.i64.cast([0,0]):(b=a.item,d[8]=b.lastActivityAuthoritativeTsMs,c.i64.neq(d[8],void 0)?d[7]=d[8]:d[7]=c.i64.cast([0,0]),d[2]=d[7])})},function(b){return c.islc(c.db.table(9).fetchDesc([[[a[0]]],"parentThreadKeyLastActivityTimestampMs"]),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?d[4]=c.i64.cast([0,0]):(b=a.item,d[8]=b.lastActivityTimestampMs,c.i64.neq(d[8],void 0)?d[7]=d[8]:d[7]=c.i64.cast([0,0]),d[4]=d[7])})},function(e){return d[6]=c.i64.gt(d[2],d[4])?d[2]:d[4],c.i64.gt(d[6],c.i64.cast([0,0]))?c.db.table(35).fetch([[[a[0]]]]).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(b){return c.db.table(35).add({parentThreadKey:a[0],lastSeenRequestTimestampMs:d[6]})},function(e){return d[8]=new c.Map(),d[8].set("parent_thread_key",a[0]),d[8].set("last_seen_time_ms",d[6]),d[9]=c.toJSON(d[8]),c.storedProcedure(b("LSIssueNewFireAndForgetTask"),"fire_forget",c.i64.cast([0,6]),d[9])}]):(f=e.item,c.i64.lt(f.lastSeenRequestTimestampMs,d[6])?c.sequence([function(b){return c.forEach(c.db.table(35).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({lastSeenRequestTimestampMs:d[6]})})},function(e){return d[8]=new c.Map(),d[8].set("parent_thread_key",a[0]),d[8].set("last_seen_time_ms",d[6]),d[9]=c.toJSON(d[8]),c.storedProcedure(b("LSIssueNewFireAndForgetTask"),"fire_forget",c.i64.cast([0,6]),d[9])}]):c.resolve())}):c.resolve()}])}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxMarkFolderSeenStoredProcedure";a.__tables__=["threads","folder_metadata","community_folders","client_threads"];e.exports=a}),null);
__d("LSMarkFolderSeenStoredProcedure",["LSMarkFolderSeen","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSMarkFolderSeen"),e.parentThreadKey);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("MWCMMarkBumpedThreadsSeen",["LSFactory","LSMarkBumpedThreadsSeenStoredProcedure","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a!=null&&(yield c("LSMarkBumpedThreadsSeenStoredProcedure")(c("LSFactory")(b),{secondaryParentThreadKey:a}))});return h.apply(this,arguments)}g.MWCMMarkBumpedThreadsSeen=a}),98);
__d("MWPMarkSeenDeferred",["LSFactory","LSMarkFolderSeenStoredProcedure","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a!=null&&(yield c("LSMarkFolderSeenStoredProcedure")(c("LSFactory")(b),{parentThreadKey:a}))});return h.apply(this,arguments)}g.markSeen=a}),98);